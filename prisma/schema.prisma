generator client {
  provider = "prisma-client"
  output   = "../src/generated"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN
}

enum ProfessionalType {
  MEDICO
  BIOMEDICO
  ODONTO
}

model User {
  id           String         @id @default(uuid())
  name         String
  email        String         @unique
  password     String
  role         Role           @default(USER)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt()

  professionals Professional[]
  clients       Client[]
}

model Client {
  id             String   @id @default(uuid())
  userId         String   @unique
  address        String
  phone          String
  birthDate      DateTime
  cpf            String   @unique
  profession     String
  emergencyPhone String?
  notes          String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt()

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  appointments Appointment[]
  procedures   Procedure[]
  anamneses    Anamnesis[]

  @@index([userId])
}

model Professional {
  id            String            @id @default(uuid())
  userId        String
  type          ProfessionalType
  licenseNumber String            @unique
  description   String?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt()

  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  appointments  Appointment[]
  procedures    Procedure[]

  @@index([userId])
}

model Appointment {
  id             String    @id @default(uuid())
  clientId       String
  professionalId String
  name           String
  description    String?
  dateHour       DateTime
  duration       Int
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt()

  client        Client        @relation(fields: [clientId], references: [id], onDelete: Cascade)
  professional  Professional  @relation(fields: [professionalId], references: [id], onDelete: Cascade)

  @@index([clientId])
  @@index([professionalId])
}

model Procedure {
  id             String   @id @default(uuid())
  clientId       String
  professionalId String
  name           String
  product        String?
  value          Int
  description    String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt()

  client        Client        @relation(fields: [clientId], references: [id], onDelete: Cascade)
  professional  Professional  @relation(fields: [professionalId], references: [id], onDelete: Cascade)

  @@index([clientId])
  @@index([professionalId])
}

model Anamnesis {
  id              String   @id @default(uuid())
  clientId        String
  hadPreviousAestheticTreatment Boolean
  botulinumToxin  Boolean
  botulinumRegion String?
  filler          Boolean
  fillerRegion    String?
  fillerProduct   String?
  suspensionThreads Boolean
  suspensionThreadsRegion String?
  suspensionThreadsProduct String?
  surgicalLift    Boolean
  surgicalLiftRegion String?
  surgicalLiftProduct String?
  chemicalPeeling Boolean
  chemicalPeelingRegion String?
  chemicalPeelingProduct String?
  laser           Boolean
  laserRegion     String?
  laserProduct    String?
  exposedToHeatOrColdWork Boolean

  smoker                  Boolean
  circulatoryDisorder     Boolean
  epilepsy                Boolean
  regularMenstrualCycle   Boolean
  regularIntestinalFunction Boolean
  cardiacAlterations      Boolean
  hormonalDisorder        Boolean
  hypoOrHypertension      Boolean
  renalDisorder           Boolean
  varicoseVeinsOrLesions  Boolean
  pregnant                Boolean
  gestationalWeeks        Int?
  underMedicalTreatment   Boolean
  medicalTreatmentDetails String?

  usesMedication          Boolean
  medicationDetails       String?
  allergy                 Boolean
  allergyDetails          String?
  lactoseIntolerance      Boolean
  diabetes                String? // "controlled" | "yes" | "no"
  roacutan                Boolean

  recentSurgery           Boolean
  recentSurgeryDetails    String?
  tumorOrPrecancerousLesion Boolean
  tumorOrLesionDetails    String?
  skinProblems            Boolean
  skinProblemsDetails     String?
  orthopedicProblems      Boolean
  orthopedicProblemsDetails String?
  hasBodyOrFacialProsthesis Boolean
  prosthesisDetails       String?
  usingAcids              Boolean
  acidsDetails            String?
  otherRelevantIssues     String?

  bloodPressure           String?
  height                  Float?
  initialWeight           Float?
  finalWeight             Float?

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt()

  client Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@index([clientId])
}
